#!/usr/bin/python
import os
import sys
import pefile
from capstone import*

try: 
    for Arg in sys.argv:
        x=("/"+Arg)
        file_path =os.getcwd()
        file_path_exe = file_path + x
except OSError as e:
    print(e)

try:
    pe =  pefile.PE(file_path_exe)
   
    #Get entry point
    entrypoint = pe.OPTIONAL_HEADER.AddressOfEntryPoint
        
    #compute memory address of entry code
    entrypoint_address = entrypoint+pe.OPTIONAL_HEADER.ImageBase

    #get binsary  code from  PE File Object
    binary_code = pe.get_memory_mapped_image()[entrypoint:entrypoint+100]

    #init disassembler
    disassembler = Cs(CS_ARCH_X86, CS_MODE_32)

    #disassemble oneliner
    for instruction in disassembler.disasm(binary_code, entrypoint_address):
            print "%s\t%s"  %(instruction.mnemonic,  instruction.op_str)
except OSError as e:
    print(e)
except pefile.PEFormatError as e:
    print("[-] PEFormatError: %s %e.value")
